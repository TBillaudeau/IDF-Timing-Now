"use strict";(self.webpackChunkrailtime_idf=self.webpackChunkrailtime_idf||[]).push([[935],{5161:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var o=n(4165),l=n(5861),i=n(9439),r=n(9867),a=n(8100),u=n(5147),s=n(3397),d=n(470),c=n.n(d),v=(n(6948),n(9790)),m=(n(9673),n(2834));var f=function(e){e.lineID;var t=e.stationName,n=(0,r.useState)([]),o=(0,i.Z)(n,2),l=o[0],a=o[1],u=(0,r.useState)(""),s=(0,i.Z)(u,2),d=s[0],c=(s[1],(0,r.useState)("current")),f=(0,i.Z)(c,2),p=(f[0],f[1],(0,r.useState)(null)),h=(0,i.Z)(p,2),x=(h[0],h[1],"https://prim.iledefrance-mobilites.fr/marketplace/stop-monitoring?MonitoringRef=STIF:StopArea:SP:".concat(t,":"));if((0,r.useEffect)((function(){var e=function(e,t,n){fetch(e,{headers:{Accept:"application/json",apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}}).then((function(e){return 404===e.status?null:e.json()})).then((function(e){var n,o,l,i,r=null===e||void 0===e||null===(n=e.Siri)||void 0===n||null===(o=n.ServiceDelivery)||void 0===o||null===(l=o.StopMonitoringDelivery[0])||void 0===l||null===(i=l.MonitoredStopVisit)||void 0===i?void 0:i.map((function(e){var t,n,o,l,i,r,a,u,s,d,c,v,m,f,p,h,x,g,y,N,j,w,b,M,S,C,T,k,V,A,J,D,Z,E,F,_,I,L;return{lineRef:null===e||void 0===e||null===(t=e.MonitoredVehicleJourney)||void 0===t||null===(n=t.LineRef)||void 0===n?void 0:n.value,operatorRef:null===e||void 0===e||null===(o=e.MonitoredVehicleJourney)||void 0===o||null===(l=o.OperatorRef)||void 0===l?void 0:l.value,stopPointName:null===e||void 0===e||null===(i=e.MonitoredVehicleJourney)||void 0===i||null===(r=i.MonitoredCall)||void 0===r||null===(a=r.StopPointName[0])||void 0===a?void 0:a.value,directionName:null===e||void 0===e||null===(u=e.MonitoredVehicleJourney)||void 0===u||null===(s=u.DirectionName[0])||void 0===s?void 0:s.value,destinationName:null===e||void 0===e||null===(d=e.MonitoredVehicleJourney)||void 0===d||null===(c=d.DestinationName[0])||void 0===c?void 0:c.value,vehicleJourneyName:null===e||void 0===e||null===(v=e.MonitoredVehicleJourney)||void 0===v||null===(m=v.JourneyNote[0])||void 0===m?void 0:m.value,expectedArrivalTime:null===e||void 0===e||null===(f=e.MonitoredVehicleJourney)||void 0===f||null===(p=f.MonitoredCall)||void 0===p?void 0:p.ExpectedArrivalTime,aimedArrival:null===e||void 0===e||null===(h=e.MonitoredVehicleJourney)||void 0===h||null===(x=h.MonitoredCall)||void 0===x?void 0:x.AimedArrival,expectedDepartureTime:null===e||void 0===e||null===(g=e.MonitoredVehicleJourney)||void 0===g||null===(y=g.MonitoredCall)||void 0===y?void 0:y.ExpectedDepartureTime,aimedDepartureTime:null===e||void 0===e||null===(N=e.MonitoredVehicleJourney)||void 0===N||null===(j=N.MonitoredCall)||void 0===j?void 0:j.aimedDepartureTime,arrivalStatus:null===e||void 0===e||null===(w=e.MonitoredVehicleJourney)||void 0===w||null===(b=w.MonitoredCall)||void 0===b?void 0:b.ArrivalStatus,departureStatus:null===e||void 0===e||null===(M=e.MonitoredVehicleJourney)||void 0===M||null===(S=M.MonitoredCall)||void 0===S?void 0:S.DepartureStatus,vehicleAtStop:null===e||void 0===e||null===(C=e.MonitoredVehicleJourney)||void 0===C||null===(T=C.MonitoredCall)||void 0===T?void 0:T.VehicleAtStop,arrivalPlatform:null===e||void 0===e||null===(k=e.MonitoredVehicleJourney)||void 0===k||null===(V=k.MonitoredCall)||void 0===V||null===(A=V.ArrivalPlatformName)||void 0===A?void 0:A.value,trainNumber:null===e||void 0===e||null===(J=e.MonitoredVehicleJourney)||void 0===J||null===(D=J.TrainNumber)||void 0===D||null===(Z=D.TrainNumberRef[0])||void 0===Z?void 0:Z.value,minutesFromNow:(L=(null===e||void 0===e||null===(E=e.MonitoredVehicleJourney)||void 0===E||null===(F=E.MonitoredCall)||void 0===F?void 0:F.ExpectedDepartureTime)||(null===e||void 0===e||null===(_=e.MonitoredVehicleJourney)||void 0===_||null===(I=_.MonitoredCall)||void 0===I?void 0:I.ExpectedArrivalTime),Math.floor((new Date(L)-new Date)/6e4))}}));t(r.sort((function(e,t){return e.minutesFromNow-t.minutesFromNow})))})).catch((function(e){return console.error(e)}))};e(x,a);var t=setInterval((function(){return e(x,a)}),2e3);return function(){return clearInterval(t)}}),[]),"NO_REALTIME_SCHEDULES_FOUND"===d)return(0,m.jsx)("div",{className:"flex items-center justify-center text-center text-xs lg:text-base bg-white dark:bg-gray-700 dark:text-gray-200 rounded-lg shadow-md p-4 mb-3 h-[44px] lg:h-[72px]",children:(0,m.jsx)("p",{className:"animate-pulse",children:"Information en direct indisponible"})});var g=l.reduce((function(e,t){var n=t.lineRef;e[n]||(e[n]={});var o=t.destinationName;return e[n][o]||(e[n][o]=[]),e[n][o].push(t),e}),{});return(0,m.jsx)("div",{className:"",children:Object.entries(g).map((function(e){var t=(0,i.Z)(e,2),n=t[0],o=t[1];return(0,m.jsxs)("div",{className:"flex border-b-4 border-slate-800",children:[(0,m.jsxs)("div",{className:"flex items-start justify-center w-20 lg:w-32 mt-2",children:[(0,m.jsx)("img",{src:"/IDF-Timing-Now"+"/images/".concat((0,v.tX)(n.split("::").pop().split(":")[0])).concat("dark"===localStorage.theme?"_LIGHT":"",".svg"),alt:(0,v.tX)(n.split("::").pop().split(":")[0]),className:"h-6 lg:h-10 mr-1"}),(0,m.jsx)(v.BU,{lineID:n.split("::").pop().split(":")[0],className:"h-6 lg:h-10"})]}),(0,m.jsx)("div",{className:"flex flex-col justify-start w-full",children:Object.entries(o).sort((function(e,t){var n=(0,i.Z)(e,1)[0],o=(0,i.Z)(t,1)[0];return n.localeCompare(o)})).map((function(e){var t=(0,i.Z)(e,2),n=t[0],o=t[1];return(0,m.jsxs)("div",{className:"flex items-center justify-between bg-white border-gray-400 dark:text-white dark:bg-gray-700 h-11 text-sm space-x-2 p-1 lg:p-4",children:[(0,m.jsx)("p",{className:"line-clamp-2",children:n}),(0,m.jsx)("div",{className:"flex space-x-2 w-28 overflow-auto justify-start shrink-0",children:o.map((function(e,t){return(0,m.jsx)("span",{className:"w-10 shrink-0 text-center text-sm lg:text-xl font-semibold text-yellow-500 bg-slate-800 rounded p-1 ".concat("0"===e.minutesFromNow?"animate-pulse":""),children:e.minutesFromNow},t)}))})]},n)}))})]},n)}))})},p=n(342),h=n(4925),x=n(5293),g=n(9457),y=n(5430),N=["data"],j=(0,x.Au)((function(e,t){var n=e.data,o=(0,h.Z)(e,N),l=new d.GeoJSON(n,o);return(0,g.O)(l,(0,y.sj)(t,{overlayContainer:l}))}),(function(e,t,n){t.style!==n.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))})),w=(n(1550),function(){var e=(0,r.useState)(null),t=(0,i.Z)(e,2),n=t[0],d=t[1],v=(0,r.useState)(""),h=(0,i.Z)(v,2),x=h[0],g=h[1],y=(0,r.useRef)(),N=function(){var e=(0,r.useState)(null),t=(0,i.Z)(e,2),n=t[0],u=t[1];return(0,a.zV)({moveend:function(e){var t=e.target.getCenter();u(t)}}),(0,r.useEffect)((function(){if(n){var e=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var t,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://prim.iledefrance-mobilites.fr/marketplace/v2/navitia/coord/".concat(n.lng,";").concat(n.lat,"/stop_areas?distance=400"),{headers:{apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}});case 2:return t=e.sent,e.next=5,t.json();case 5:l=e.sent,console.log(l),g(l.stop_areas);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}}),[n]),null},w=function(){return(0,m.jsx)("span",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[1000] bg-violet-700 rounded-full p-2 border-4 border-white"})};(0,r.useEffect)((function(){navigator.geolocation.getCurrentPosition((function(e){d([e.coords.latitude,e.coords.longitude])}),(function(e){console.error("Error occurred while getting geolocation: ",e),n||d([48.8598,2.347])}))}),[]);var b=function(){var e=(0,a.Sx)();return(0,r.useEffect)((function(){var t=new(c().Control)({position:"bottomright"});return t.onAdd=function(){var t=c().DomUtil.create("button","leaflet-bar leaflet-control leaflet-control-custom");return t.innerHTML='<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20"><path d="M7 0a7 7 0 0 0-1 13.92V19a1 1 0 1 0 2 0v-5.08A7 7 0 0 0 7 0Zm0 5.5A1.5 1.5 0 0 0 5.5 7a1 1 0 0 1-2 0A3.5 3.5 0 0 1 7 3.5a1 1 0 0 1 0 2Z"/></svg>',t.style.cssText="background-color: white; padding: 6px; cursor: pointer;",t.onclick=function(){return n&&e.flyTo(n,13)},t},t.addTo(e),function(){return t.remove()}}),[e]),null};return(0,m.jsxs)("div",{style:{height:"calc(100vh - 130px)"},children:[n&&(0,m.jsxs)(u.h,{className:"h-[40%]",whenCreated:function(e){y.current=e},center:n,zoom:13,attributionControl:!1,zoomControl:!1,children:[(0,m.jsx)(s.I,{url:"https://{s}.tile.jawg.io/jawg-streets/{z}/{x}/{y}{r}.png?access-token=".concat("NLjqJ26jQLT3FtdLL3392vMpTDEAjiSi3aye5i0XblTjBD5Eo0N1Q5HjG5FReW7u")}),(0,m.jsx)(N,{}),(0,m.jsx)(b,{}),(0,m.jsx)(w,{}),p.map((function(e,t){return e.fields&&e.fields.geo_shape&&e.fields.geo_shape.coordinates?(0,m.jsx)(j,{data:{type:"LineString",coordinates:e.fields.geo_shape.coordinates},style:{color:"#"+e.fields.colourweb_hexa}},t):null}))]}),x&&(0,m.jsx)("div",{className:"h-[60%] overflow-y-scroll",children:x.map((function(e,t){return(0,m.jsxs)("div",{className:"mx-2 my-4",children:[(0,m.jsx)("h1",{className:"text-white text-sm bg-slate-800 w-full rounded-t-lg p-3",children:e.name}),(0,m.jsx)(f,{line:null,stationName:e.id.split(":").pop()},e.id)]})}))})]})})}}]);
//# sourceMappingURL=935.1e689acf.chunk.js.map