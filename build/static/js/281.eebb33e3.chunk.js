"use strict";(self.webpackChunkrailtime_idf=self.webpackChunkrailtime_idf||[]).push([[281],{6894:function(e,t,r){r.r(t),r.d(t,{default:function(){return y}});var l=r(4165),n=r(5861),i=r(9439),o=r(9867),a=r(8100),s=r(5147),d=r(3397),u=r(470),c=r.n(u),v=(r(6948),r(7353)),p=(r(1211),r(4467),r(9228)),m=r(9673),h=r(2834);var g=function(e){e.lineID;var t=e.stationName,r=(0,o.useState)([]),l=(0,i.Z)(r,2),n=l[0],a=l[1],s=(0,o.useState)(""),d=(0,i.Z)(s,2),u=d[0],c=d[1],g="https://prim.iledefrance-mobilites.fr/marketplace/stop-monitoring?MonitoringRef=STIF:StopArea:SP:".concat(t,":");function f(e){var t;return function(e,t,r){var l=[parseInt(e.slice(0,2),16),parseInt(e.slice(2,4),16),parseInt(e.slice(4,6),16)],n=l[0],i=l[1],o=l[2],a=[parseInt(t.slice(0,2),16),parseInt(t.slice(2,4),16),parseInt(t.slice(4,6),16)],s=a[0],d=a[1],u=a[2];return((Math.round(n*(1-r)+s*r)<<16)+(Math.round(i*(1-r)+d*r)<<8)+Math.round(o*(1-r)+u*r)).toString(16).padStart(6,"0")}(null===(t=p.find((function(t){return t.fields.id_line==e})))||void 0===t?void 0:t.fields.colourweb_hexa,"ffffff",.5)}return(0,o.useEffect)((function(){var e=function(e,t,r){fetch(e,{headers:{Accept:"application/json",apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}}).then((function(e){return 404===e.status?null:e.json()})).then((function(e){var l,n,i,o,a=null===e||void 0===e||null===(l=e.Siri)||void 0===l||null===(n=l.ServiceDelivery)||void 0===n||null===(i=n.StopMonitoringDelivery[0])||void 0===i||null===(o=i.MonitoredStopVisit)||void 0===o?void 0:o.map((function(e){var t,r,l,n,i,o,a,s,d,u,c,v,p,m,h,g,f,x,y,w,j,b,N,M,k,S,A,D,T;return{lineRef:null===e||void 0===e||null===(t=e.MonitoredVehicleJourney)||void 0===t||null===(r=t.LineRef)||void 0===r?void 0:r.value,operatorRef:null===e||void 0===e||null===(l=e.MonitoredVehicleJourney)||void 0===l||null===(n=l.OperatorRef)||void 0===n?void 0:n.value,directionName:null===e||void 0===e||null===(i=e.MonitoredVehicleJourney)||void 0===i||null===(o=i.DirectionName[0])||void 0===o?void 0:o.value,destinationName:null===e||void 0===e||null===(a=e.MonitoredVehicleJourney)||void 0===a||null===(s=a.DestinationName[0])||void 0===s?void 0:s.value,vehicleJourneyName:null===e||void 0===e||null===(d=e.MonitoredVehicleJourney)||void 0===d||null===(u=d.VehicleJourneyName[0])||void 0===u?void 0:u.value,expectedArrivalTime:null===e||void 0===e||null===(c=e.MonitoredVehicleJourney)||void 0===c||null===(v=c.MonitoredCall)||void 0===v?void 0:v.ExpectedArrivalTime,aimedArrival:null===e||void 0===e||null===(p=e.MonitoredVehicleJourney)||void 0===p||null===(m=p.MonitoredCall)||void 0===m?void 0:m.AimedArrival,expectedDepartureTime:null===e||void 0===e||null===(h=e.MonitoredVehicleJourney)||void 0===h||null===(g=h.MonitoredCall)||void 0===g?void 0:g.ExpectedDepartureTime,aimedDepartureTime:null===e||void 0===e||null===(f=e.MonitoredVehicleJourney)||void 0===f||null===(x=f.MonitoredCall)||void 0===x?void 0:x.aimedDepartureTime,arrivalStatus:null===e||void 0===e||null===(y=e.MonitoredVehicleJourney)||void 0===y||null===(w=y.MonitoredCall)||void 0===w?void 0:w.ArrivalStatus,departureStatus:null===e||void 0===e||null===(j=e.MonitoredVehicleJourney)||void 0===j||null===(b=j.MonitoredCall)||void 0===b?void 0:b.DepartureStatus,vehicleAtStop:null===e||void 0===e||null===(N=e.MonitoredVehicleJourney)||void 0===N||null===(M=N.MonitoredCall)||void 0===M?void 0:M.VehicleAtStop,minutesFromNow:(T=(null===e||void 0===e||null===(k=e.MonitoredVehicleJourney)||void 0===k||null===(S=k.MonitoredCall)||void 0===S?void 0:S.ExpectedDepartureTime)||(null===e||void 0===e||null===(A=e.MonitoredVehicleJourney)||void 0===A||null===(D=A.MonitoredCall)||void 0===D?void 0:D.ExpectedArrivalTime),Math.round((new Date(T)-new Date)/6e4))}}));t(a.sort((function(e,t){return e.minutesFromNow-t.minutesFromNow}))),r(e.nextDepartures.errorMessage)})).catch((function(e){return console.error(e)}))};e(g,a,c);var t=setInterval((function(){return e(g,a,c)}),2e3);return function(){return clearInterval(t)}}),[t]),"NO_REALTIME_SCHEDULES_FOUND"===u?(0,h.jsx)("div",{className:"flex items-center justify-center text-center text-xs lg:text-base bg-white dark:bg-gray-700 dark:text-gray-200 rounded-lg shadow-md p-4 mb-3 h-[44px] lg:h-[72px]",children:(0,h.jsx)("p",{className:"animate-pulse",children:"Information en direct indisponible"})}):0===n.length?(0,h.jsx)("div",{className:"overflow-y-auto max-h-[27rem] animate-pulse",children:(0,h.jsxs)("div",{className:"flex items-center bg-white dark:bg-gray-800 rounded-lg shadow-md h-[44px] lg:h-[72px]",children:[(0,h.jsx)("div",{role:"status",class:"flex items-center justify-center w-4 lg:w-10 h-4 lg:h-10 ml-1 lg:ml-0 mr-2 lg:mr-4 p-1 bg-gray-300 rounded-sm lg:rounded-lg dark:bg-gray-700",children:(0,h.jsx)("svg",{class:"w-5 h-5 text-gray-200 dark:text-gray-600","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 20 18",children:(0,h.jsx)("path",{d:"M18 0H2a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2Zm-5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm4.376 10.481A1 1 0 0 1 16 15H4a1 1 0 0 1-.895-1.447l3.5-7A1 1 0 0 1 7.468 6a.965.965 0 0 1 .9.5l2.775 4.757 1.546-1.887a1 1 0 0 1 1.618.1l2.541 4a1 1 0 0 1 .028 1.011Z"})})}),(0,h.jsxs)("div",{className:"flex-grow",children:[(0,h.jsx)("div",{class:"w-12 lg:w-24 h-1 lg:h-2.5 mb-1 lg:mb-2.5 bg-gray-300 rounded-full dark:bg-gray-600"}),(0,h.jsx)("div",{class:"w-16 lg:w-32 h-1 lg:h-2 bg-gray-200 rounded-full dark:bg-gray-700"})]}),(0,h.jsxs)("div",{className:"ml-2 lg:ml-5 min-w-max pr-2 text-right",children:[(0,h.jsx)("div",{class:"w-6 lg:w-12 h-1 lg:h-2.5 mb-1 lg:mb-2.5 mr-1 bg-gray-300 rounded-full dark:bg-gray-700"}),(0,h.jsx)("div",{class:"w-4 lg:w-8 h-1 lg:h-2 mr-1 bg-gray-200 rounded-full float-right dark:bg-gray-700"})]})]})}):(n.reduce((function(e,t){var r=(0,v.OV)(t.lineDirection);return e[r]||(e[r]=[]),e[r].push(t),e}),{}),(0,h.jsx)("div",{className:"",children:n.map((function(e,t){return(0,h.jsxs)("div",{className:"flex items-center bg-white border-gray-400 dark:text-white dark:bg-gray-700 min-h-[44px] max-h-[72px] p-1 lg:p-4 relative",style:{borderBottom:"4px solid #".concat(f(e.lineRef.replace(/:$/,"").split(":").pop()))},children:[(0,h.jsxs)("div",{className:"shrink-0",children:[(0,h.jsx)(m.Z,{lineID:e.lineRef.replace(/:$/,"").split(":").pop(),className:"h-6 lg:h-10 pl-1 lg:pl-0 mr-2 lg:mr-4"}),(0,h.jsx)("h3",{className:"text-[8px] lg:text-xs justify-center flex mx-auto mt-0.5 pl-0.5 lg:pl-0",children:e.vehicleJourneyName})]}),(0,h.jsx)("div",{className:"flex-grow overflow-hidden",children:(0,h.jsxs)("h2",{className:"font-bold text-[11px] lg:text-lg line-clamp-2 ml-2 lg:ml-4",children:[e.destinationName," - ",e.aimedArrival," - ",e.vehicleAtStop]})}),(0,h.jsxs)("div",{className:"ml-1 lg:ml-5 pr-2 text-right",children:[(0,h.jsxs)("p",{className:"text-sm lg:text-2xl font-bold",children:[e.departureStatus," ",e.minutesFromNow,"\u1d50\u2071\u207f"]}),(0,h.jsxs)("p",{className:"text-xs lg:text-sm text-right text-gray-400 dark:text-white",children:["Arrival: ",new Date(e.expectedArrivalTime).toLocaleTimeString()]}),(0,h.jsxs)("p",{className:"text-xs lg:text-sm text-right text-gray-400 dark:text-white",children:["Departure: ",new Date(e.expectedDepartureTime).toLocaleTimeString()]})]}),(0,h.jsx)("div",{className:"absolute top-0 right-0 bottom-0 left-0 lg:left-0 bg-gradient-to-r from-transparent to-white dark:to-gray-700",style:{backgroundImage:"linear-gradient(to right, transparent, rgba(".concat(parseInt(f(e.lineRef.replace(/:$/,"").split(":").pop()).slice(0,2),16),", ").concat(parseInt(f(e.lineRef.replace(/:$/,"").split(":").pop()).slice(2,4),16),", ").concat(parseInt(f(e.lineRef.replace(/:$/,"").split(":").pop()).slice(4,6),16),", 0.1))")}})]},t)}))}))},f=r(342),x=r(3743),y=(r(1550),function(){var e=(0,o.useState)(null),t=(0,i.Z)(e,2),r=t[0],u=t[1],v=(0,o.useState)(""),p=(0,i.Z)(v,2),m=p[0],y=p[1],w=(0,o.useRef)(),j=function(){var e=(0,o.useState)(null),t=(0,i.Z)(e,2),r=t[0],s=t[1];return(0,a.zV)({moveend:function(e){var t=e.target.getCenter();s(t)}}),(0,o.useEffect)((function(){if(r){var e=function(){var e=(0,n.Z)((0,l.Z)().mark((function e(){var t,n;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://prim.iledefrance-mobilites.fr/marketplace/navitia/coverage/fr-idf/coord/".concat(r.lng,";").concat(r.lat,"/stop_areas?distance=400"),{headers:{apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}});case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,y(n.stop_areas);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}}),[r]),null},b=function(){return(0,h.jsx)("span",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[1000] bg-violet-700 rounded-full p-2 border-4 border-white"})};(0,o.useEffect)((function(){navigator.geolocation.getCurrentPosition((function(e){u([e.coords.latitude,e.coords.longitude])}),(function(e){console.error("Error occurred while getting geolocation: ",e),r||u([48.8598,2.347])}))}),[]);var N=function(){var e=(0,a.Sx)();return(0,o.useEffect)((function(){var t=new(c().Control)({position:"bottomright"});return t.onAdd=function(){var t=c().DomUtil.create("button","leaflet-bar leaflet-control leaflet-control-custom");return t.innerHTML='<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20"><path d="M7 0a7 7 0 0 0-1 13.92V19a1 1 0 1 0 2 0v-5.08A7 7 0 0 0 7 0Zm0 5.5A1.5 1.5 0 0 0 5.5 7a1 1 0 0 1-2 0A3.5 3.5 0 0 1 7 3.5a1 1 0 0 1 0 2Z"/></svg>',t.style.cssText="background-color: white; padding: 6px; cursor: pointer;",t.onclick=function(){return r&&e.flyTo(r,13)},t},t.addTo(e),function(){return t.remove()}}),[e]),null};return(0,h.jsxs)("div",{style:{height:"calc(100vh - 130px)"},children:[r&&(0,h.jsxs)(s.h,{className:"h-[40%]",whenCreated:function(e){w.current=e},center:r,zoom:13,attributionControl:!1,children:[(0,h.jsx)(d.I,{url:"https://{s}.tile.jawg.io/jawg-streets/{z}/{x}/{y}{r}.png?access-token=".concat("NLjqJ26jQLT3FtdLL3392vMpTDEAjiSi3aye5i0XblTjBD5Eo0N1Q5HjG5FReW7u")}),(0,h.jsx)(j,{}),(0,h.jsx)(N,{}),(0,h.jsx)(b,{}),f.map((function(e,t){return(0,h.jsx)(x.Q,{data:e.geo_shape.geometry,style:{color:"#"+e.colourweb_hexa}},t)}))]}),m&&(0,h.jsx)("div",{className:"h-[60%] overflow-y-scroll",children:m.map((function(e,t){return(0,h.jsx)(g,{line:null,stationName:e.id.split(":").pop()})}))})]})})},3743:function(e,t,r){r.d(t,{Q:function(){return d}});var l=r(4925),n=r(5293),i=r(9457),o=r(5430),a=r(470),s=["data"],d=(0,n.Au)((function(e,t){var r=e.data,n=(0,l.Z)(e,s),d=new a.GeoJSON(r,n);return(0,i.O)(d,(0,o.sj)(t,{overlayContainer:d}))}),(function(e,t,r){t.style!==r.style&&(null==t.style?e.resetStyle():e.setStyle(t.style))}))}}]);
//# sourceMappingURL=281.eebb33e3.chunk.js.map