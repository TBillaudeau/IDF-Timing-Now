"use strict";(self.webpackChunkrailtime_idf=self.webpackChunkrailtime_idf||[]).push([[46],{2814:function(e,n,t){var o=t(9439),l=t(9867),i=t(9790),r=t(7353),a=(t(9673),t(2834));n.Z=function(e){e.lineID;var n=e.stationName,t=(0,l.useState)([]),u=(0,o.Z)(t,2),d=u[0],s=u[1],c=(0,l.useState)(""),v=(0,o.Z)(c,2),f=v[0],m=(v[1],(0,l.useState)("current")),p=(0,o.Z)(m,2),h=(p[0],p[1],(0,l.useState)(null)),x=(0,o.Z)(h,2),y=(x[0],x[1],"https://prim.iledefrance-mobilites.fr/marketplace/stop-monitoring?MonitoringRef=STIF:StopArea:SP:".concat(n,":"));if((0,l.useEffect)((function(){var e=function(e,n,t){fetch(e,{headers:{Accept:"application/json",apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}}).then((function(e){return 404===e.status?null:e.json()})).then((function(e){var t,o,l,i,r,a=null===e||void 0===e||null===(t=e.Siri)||void 0===t||null===(o=t.ServiceDelivery)||void 0===o||null===(l=o.StopMonitoringDelivery[0])||void 0===l||null===(i=l.MonitoredStopVisit)||void 0===i||null===(r=i.filter((function(e){var n,t,o,l,i=null===e||void 0===e||null===(n=e.MonitoredVehicleJourney)||void 0===n||null===(t=n.MonitoredCall)||void 0===t?void 0:t.ExpectedDepartureTime;return!((null===e||void 0===e||null===(o=e.MonitoredVehicleJourney)||void 0===o||null===(l=o.MonitoredCall)||void 0===l?void 0:l.VehicleAtStop)&&new Date(i)<new Date)})))||void 0===r?void 0:r.map((function(e){var n,t,o,l,i,r,a,u,d,s,c,v,f,m,p,h,x,y,g,N,j,w,b,M,S,V,C,J,T,A,Z,k,D,E,F,R,_,I,L,O,U,z,P;return{lineRef:null===e||void 0===e||null===(n=e.MonitoredVehicleJourney)||void 0===n||null===(t=n.LineRef)||void 0===t?void 0:t.value,operatorRef:null===e||void 0===e||null===(o=e.MonitoredVehicleJourney)||void 0===o||null===(l=o.OperatorRef)||void 0===l?void 0:l.value,stopPointName:null===e||void 0===e||null===(i=e.MonitoredVehicleJourney)||void 0===i||null===(r=i.MonitoredCall)||void 0===r||null===(a=r.StopPointName[0])||void 0===a?void 0:a.value,directionName:null===e||void 0===e||null===(u=e.MonitoredVehicleJourney)||void 0===u||null===(d=u.DirectionName[0])||void 0===d?void 0:d.value,destinationName:null===e||void 0===e||null===(s=e.MonitoredVehicleJourney)||void 0===s||null===(c=s.DestinationName[0])||void 0===c?void 0:c.value,vehicleJourneyNote:null===e||void 0===e||null===(v=e.MonitoredVehicleJourney)||void 0===v||null===(f=v.JourneyNote[0])||void 0===f?void 0:f.value,vehicleJourneyName:(null===e||void 0===e||null===(m=e.MonitoredVehicleJourney)||void 0===m||null===(p=m.VehicleJourneyName[0])||void 0===p?void 0:p.value)||(null===e||void 0===e||null===(h=e.MonitoredVehicleJourney)||void 0===h||null===(x=h.TrainNumbers)||void 0===x||null===(y=x.TrainNumberRef[0])||void 0===y?void 0:y.value),expectedArrivalTime:null===e||void 0===e||null===(g=e.MonitoredVehicleJourney)||void 0===g||null===(N=g.MonitoredCall)||void 0===N?void 0:N.ExpectedArrivalTime,aimedArrival:null===e||void 0===e||null===(j=e.MonitoredVehicleJourney)||void 0===j||null===(w=j.MonitoredCall)||void 0===w?void 0:w.AimedArrival,expectedDepartureTime:null===e||void 0===e||null===(b=e.MonitoredVehicleJourney)||void 0===b||null===(M=b.MonitoredCall)||void 0===M?void 0:M.ExpectedDepartureTime,aimedArrivalTime:null===e||void 0===e||null===(S=e.MonitoredVehicleJourney)||void 0===S||null===(V=S.MonitoredCall)||void 0===V?void 0:V.AimedArrivalTime,arrivalStatus:null===e||void 0===e||null===(C=e.MonitoredVehicleJourney)||void 0===C||null===(J=C.MonitoredCall)||void 0===J?void 0:J.ArrivalStatus,departureStatus:null===e||void 0===e||null===(T=e.MonitoredVehicleJourney)||void 0===T||null===(A=T.MonitoredCall)||void 0===A?void 0:A.DepartureStatus,vehicleAtStop:null===e||void 0===e||null===(Z=e.MonitoredVehicleJourney)||void 0===Z||null===(k=Z.MonitoredCall)||void 0===k?void 0:k.VehicleAtStop,arrivalPlatform:null===e||void 0===e||null===(D=e.MonitoredVehicleJourney)||void 0===D||null===(E=D.MonitoredCall)||void 0===E||null===(F=E.ArrivalPlatformName)||void 0===F?void 0:F.value,trainNumber:null===e||void 0===e||null===(R=e.MonitoredVehicleJourney)||void 0===R||null===(_=R.TrainNumber)||void 0===_||null===(I=_.TrainNumberRef[0])||void 0===I?void 0:I.value,minutesFromNow:(P=(null===e||void 0===e||null===(L=e.MonitoredVehicleJourney)||void 0===L||null===(O=L.MonitoredCall)||void 0===O?void 0:O.ExpectedDepartureTime)||(null===e||void 0===e||null===(U=e.MonitoredVehicleJourney)||void 0===U||null===(z=U.MonitoredCall)||void 0===z?void 0:z.ExpectedArrivalTime),Math.floor((new Date(P)-new Date)/6e4))}}));n(a.sort((function(e,n){return e.minutesFromNow-n.minutesFromNow})))})).catch((function(e){return console.error(e)}))};e(y,s);var n=setInterval((function(){return e(y,s)}),2e3);return function(){return clearInterval(n)}}),[]),"NO_REALTIME_SCHEDULES_FOUND"===f)return(0,a.jsx)("div",{className:"flex items-center justify-center text-center text-xs lg:text-base bg-white dark:bg-gray-700 dark:text-gray-200 rounded-lg shadow-md p-4 mb-3 h-[44px] lg:h-[72px]",children:(0,a.jsx)("p",{className:"animate-pulse",children:"Information en direct indisponible"})});var g=d.reduce((function(e,n){var t=n.lineRef;e[t]||(e[t]={});var o=n.destinationName;return e[t][o]||(e[t][o]=[]),e[t][o].push(n),e}),{});return(0,a.jsx)("div",{className:"",children:Object.entries(g).map((function(e){var n=(0,o.Z)(e,2),t=n[0],l=n[1],u=(0,i.tX)(t.split("::").pop().split(":")[0]);return(0,a.jsxs)("div",{className:"flex border-b-4 border-slate-800 border-x",children:[(0,a.jsxs)("div",{className:"flex items-start justify-center w-20 lg:w-32 pt-2 lg:pt-1.5 bg-white border-r",children:[u&&(0,a.jsx)("img",{src:"/IDF-Timing-Now"+"/images/".concat(u,".svg"),alt:u,className:"h-6 lg:h-8 mr-1"}),(0,a.jsx)(i.BU,{lineID:t.split("::").pop().split(":")[0],className:"h-6 lg:h-8"})]}),(0,a.jsx)("div",{className:"flex flex-col justify-start w-full",children:Object.entries(l).sort((function(e,n){var t=(0,o.Z)(e,1)[0],l=(0,o.Z)(n,1)[0];return t.localeCompare(l)})).map((function(e,n,t){var l=(0,o.Z)(e,2),i=l[0],u=l[1];return(0,a.jsxs)("div",{className:"flex items-center justify-between border-gray-400 dark:text-white dark:bg-gray-700 h-10 text-sm space-x-2 p-1 lg:p-4 ".concat(n<t.length-1?"border-b":""),children:[(0,a.jsx)("p",{className:"line-clamp-1",children:(0,r.OV)(i)}),(0,a.jsx)("div",{className:"flex space-x-2 w-40 lg:w-48 overflow-auto justify-start shrink-0",children:u.map((function(e,n){return(0,a.jsx)("span",{className:"w-10 shrink-0 text-center text-sm font-bold text-yellow-500 bg-slate-800 rounded p-1 lg:py-1",children:(0,a.jsx)("span",{className:"".concat(e.minutesFromNow<=0?"animate-pulse":""),children:e.minutesFromNow})},n)}))})]},i)}))})]},t)}))})}},2401:function(e,n,t){t.r(n),t.d(n,{default:function(){return j}});var o=t(4165),l=t(5861),i=t(9439),r=t(9867),a=t(8100),u=t(5147),d=t(3397),s=t(470),c=t.n(s),v=(t(6948),t(2814)),f=t(342),m=t(4925),p=t(5293),h=t(9457),x=t(5430),y=["data"],g=(0,p.Au)((function(e,n){var t=e.data,o=(0,m.Z)(e,y),l=new s.GeoJSON(t,o);return(0,h.O)(l,(0,x.sj)(n,{overlayContainer:l}))}),(function(e,n,t){n.style!==t.style&&(null==n.style?e.resetStyle():e.setStyle(n.style))})),N=(t(1550),t(2834)),j=function(){var e=(0,r.useState)(null),n=(0,i.Z)(e,2),t=n[0],s=n[1],m=(0,r.useState)(null),p=(0,i.Z)(m,2),h=p[0],x=p[1],y=(0,r.useState)(""),j=(0,i.Z)(y,2),w=j[0],b=j[1],M=(0,r.useRef)(),S=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(n){var t,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://prim.iledefrance-mobilites.fr/marketplace/v2/navitia/coord/".concat(n.lng,";").concat(n.lat,"/stop_areas?distance=300"),{headers:{apikey:"l5iC8ZUjTN6WAevyFkU1tV8zkTbmNdjb"}});case 2:return t=e.sent,e.next=5,t.json();case 5:l=e.sent,b(l.stop_areas);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=(0,r.useState)(null),n=(0,i.Z)(e,2),t=n[0],u=n[1];return(0,a.zV)({moveend:function(e){var n=e.target.getCenter();u(n)}}),(0,r.useEffect)((function(){if(t){var e=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t);case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}}),[t]),null},C=function(){return(0,N.jsx)("span",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[1000] bg-violet-700 rounded-full p-1.5 border-2 border-white"})};(0,r.useEffect)((function(){navigator.geolocation.getCurrentPosition((function(e){var n=[e.coords.latitude,e.coords.longitude];s(n),h||(S({lat:n[0],lng:n[1]}),x({lat:n[0],lng:n[1]}))}),(function(e){console.error("Error occurred while getting geolocation: ",e),t||s([48.8598,2.347])}))}),[]);var J=function(){var e=(0,a.Sx)();return(0,r.useEffect)((function(){var n=new(c().Control)({position:"bottomright"});return n.onAdd=function(){var n=c().DomUtil.create("button","leaflet-bar leaflet-control leaflet-control-custom");return n.innerHTML='<svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20"><path d="M7 0a7 7 0 0 0-1 13.92V19a1 1 0 1 0 2 0v-5.08A7 7 0 0 0 7 0Zm0 5.5A1.5 1.5 0 0 0 5.5 7a1 1 0 0 1-2 0A3.5 3.5 0 0 1 7 3.5a1 1 0 0 1 0 2Z"/></svg>',n.style.cssText="background-color: white; padding: 6px; cursor: pointer;",n.onclick=function(){return t&&e.flyTo(t,13)},n},n.addTo(e),function(){return n.remove()}}),[e]),null};return(0,N.jsxs)("div",{style:{height:"calc(100vh - 130px)"},children:[t&&(0,N.jsxs)(u.h,{className:"h-[35%]",whenCreated:function(e){M.current=e},center:t,zoom:13,attributionControl:!1,zoomControl:!1,children:[(0,N.jsx)(d.I,{url:"https://{s}.tile.jawg.io/jawg-streets/{z}/{x}/{y}{r}.png?access-token=".concat("NLjqJ26jQLT3FtdLL3392vMpTDEAjiSi3aye5i0XblTjBD5Eo0N1Q5HjG5FReW7u")}),(0,N.jsx)(V,{}),(0,N.jsx)(J,{}),(0,N.jsx)(C,{}),f.map((function(e,n){return e.fields&&e.fields.geo_shape&&e.fields.geo_shape.coordinates?(0,N.jsx)(g,{data:{type:"LineString",coordinates:e.fields.geo_shape.coordinates},style:{color:"#"+e.fields.colourweb_hexa}},n):null}))]}),w&&(0,N.jsx)("div",{className:"h-[65%] overflow-y-scroll",children:w.map((function(e,n){return(0,N.jsxs)("div",{className:"mx-0 my-4",children:[(0,N.jsx)("h1",{className:"text-white text-xs text-center font-medium bg-slate-800 w-full rounded-t-lg p-2",children:e.name}),(0,N.jsx)(v.Z,{line:null,stationName:e.id.split(":").pop()},e.id)]})}))})]})}}}]);
//# sourceMappingURL=46.3538b65d.chunk.js.map